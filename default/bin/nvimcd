#!/usr/bin/env python3
"""Cd nvim host instance"""
from __future__ import print_function
import os
import sys

try:
    from neovim import attach
    addr = os.environ.get("NVIM_LISTEN_ADDRESS", None)
except:
    addr = False

if not sys.argv[1]:
    print("Usage: {} <dirname>".format(sys.argv[0]))
    addr = False

if not addr:
    sys.exit(1)

nvim = attach("socket", path=addr)

def _setup():
    nvim.vars['b:terminal_path'] = sys.argv[1]
    nvim.command('let b:terminal_path=fnameescape("' + sys.argv[1] + '")\n\
    exe "cd " . b:terminal_path\n\
    call rpcnotify(' + str(nvim.channel_id) + ', "n")')

def _exit(*args):
    nvim.stop_loop()

nvim.run_loop(_exit, _exit, _setup)
