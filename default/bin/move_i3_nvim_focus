#!/bin/sh

nvim_addr="$(xprop -id $(xprop -root _NET_ACTIVE_WINDOW | cut -d "#" -f 2) WM_NAME | cut -d '"' -f 2)"

if [[ "$nvim_addr" != /tmp/* ]] ; then
	i3-msg focus "$1"
	exit
fi

where="h"
case $1 in
	"left") where="h";;
	"down") where="j";;
	"up") where="k";;
	"right") where="l";;
	*) exit 1
esac

echo "import neovim
nvim = neovim.attach('socket', path='$nvim_addr')
try:
	nvim.command(''':let g:last_window=winnr()
		wincmd $where''')
	nvim.command(':if g:last_window==winnr() | silent execute(\"!i3-msg -q focus $1\") | endif')
finally:
	nvim.stop_loop()" | python3
