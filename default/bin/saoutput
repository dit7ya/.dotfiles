#!/bin/sh
# A script to toggle between alsa audio outputs

# Find a soundcard that has both Front and Headphone
for soundcard in $(seq 0 3); do
    status=$(amixer -c "$soundcard" sget "Headphone" 2>/dev/null);
    if [ "$?" = 0 ]; then
        break;
    fi
done

# Disable Auto-Mute when another output is plugged in
amixer -c "$soundcard" -q sset "Auto-Mute Mode" Disabled

# Find out the name of the output that isn't "Headphone"
# output=$(amixer -c "$soundcard" | grep -m 1 -o "Simple mixer control '\(Front\|Speaker\)'" | grep -o "Front\|Speaker")
output="Front"

# Find out if headphones are on or off
status=$(echo "$status" | grep -m 1 -o "\[\(on\|off\)\]$")
if [ "$status" = "[on]" ] ; then
    amixer -q -c "$soundcard" sset "Headphone" mute;
    amixer -q -c "$soundcard" sset "$output" unmute;
elif [ "$status" = "[off]" ] ; then
    amixer -q -c "$soundcard" sset "Headphone" unmute;
    amixer -q -c "$soundcard" sset "$output" mute;
else
    echo "Error: couldn't find a soundcard with Headphone/Front, last soundcard tried: $soundcard";
fi

